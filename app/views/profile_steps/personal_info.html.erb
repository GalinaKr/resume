<div class="container">
  <div class="card mb-5 mx-auto" style="max-width:800px">
    <div class="card-title text-center">
      <div class="h2">
        <%= I18n.t :personal_information %>
      </div>
    </div>
    <div class="card-body">
      <!--Content Card, Primary information-->
      <%= form_for @user, url: wizard_path, method: :put do |f| %>
        <div class="row">
          <div class="col-md mb-5 text-center avatar">
            <h2>Profile Picture</h2>
            <p class="mb-4">Users with a clear and recognizable photo are hired more often. <strong>(Optional)</strong></p>
            <% if @profile.avatar.attached? %>
              <div class="text-light mb-3 avatar-image" style="font-size: 170px;line-height: 0;">
                <%= image_tag @profile.avatar, class: 'rounded-circle' %>
              </div>
              <div class="custom-file">
                <%= f.file_field :profile_avatar, multiple: false, name: 'avatar', class: "d-none", id: "uploadProfilePic" %>
                <label class="btn btn-outline-primary mb-0" for="uploadProfilePic">
                  Upload photo
                </label>
                <button type="button" class="delete-avatar d-none" id="deleteProfilePic"></button>
                <label class="btn btn-outline-danger mb-0 ml-2" for="deleteProfilePic">
                  Delete
                </label>
              </div>
            <% else %>
              <div class="text-light mb-3" style="font-size: 170px;line-height: 0;"><i class="fas fa-user-circle"></i></div>
              <div class="custom-file">
                <%= f.file_field :profile_avatar, multiple: false, name: 'avatar', class: "d-none", id: "uploadProfilePic" %>
                <label class="btn btn-outline-primary" for="uploadProfilePic">
                  Upload photo
                </label>
              </div>
            <% end %>
            <div class="error-avatar text-danger mt-1"></div>
          </div>
          <div class="col">
            <%= f.label I18n.t :user_first_name, class: 'form-label' %>
            <%= f.text_field :first_name, class: 'form-control' %>

            <%= f.label I18n.t :user_second_name, class: 'form-label' %>
            <%= f.text_field :second_name, class: 'form-control' %>

            <%= f.label I18n.t :user_last_name, class: 'form-label' %>
            <%= f.text_field :last_name, class: 'form-control' %>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <%= f.label 'email', class: 'form-label' %>
            <%= f.text_field :email, class: 'form-control' %>
          </div>
          <div class="col">
            <%= f.label 'Phone number', class: 'form-label' %>
            <%= f.text_field :phone_number, class: 'form-control' %>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <%= f.label 'Location', class: 'form-label' %>
            <%= f.text_field :location, class: 'form-control' %>
          </div>
        </div>

        <div class="row align-items-center">
          <span class="btn btn-outline-primary" id="additionalInfo">
            Additional Information
          </span>
        </div>

        <!--Content Card, Additional information-->
        <div class="row collapse" id="additionalInfoForm">
          <div class="col">
            <div>
              Date of Birth
              <%= f.date_select :date_of_birth %>
            </div>
            <div>Place of Birth</div>
            <div>Sex</div>
            <div>Nationality</div>

            <!--Content Card, Martial Status-->
            <div>Marital Status
              <select class="form-select" id="martialStatus">
                <option value="no">No</option>
                <option value="yes">Yes</option>
              </select>

              <!-- If option Yes -->
              <div class="row collapse" id="married">
                <div>Name</div>
                <div>Second Name</div>
                <div>Last Name</div>
                <div>Date of Birth</div>
              </div>
            </div>

            <!--Content Card, Family-->
            <div class="row">
              <div>About Family</div>
              <span class="btn btn-outline-primary" id="addFamily">Add</span>
              <div class="row collapse" id="formFamily">
                <div>
                  <div>Name</div>
                  <div>Second Name</div>
                  <div>Last Name</div>

                  <div>Place of Work</div>
                </div>
                <div class="row">
                  <span class="btn btn-outline-primary" id="cancel">Cancel</span>
                </div>
              </div>
            </div>

            <div class="row align-items-center">
              <span class="btn btn-outline-primary" id="additionalInfoCollapse">
                Collapse
              </span>
            </div>
          </div>
        </div>

        <div class="justify-content-right">
          <%= f.submit 'Next', class: 'btn btn-primary' %>
        </div>

      <% end %>
    </div>
  </div>
</div>

<script>
    $('#additionalInfo').on('click', () => {
        $('#additionalInfo').addClass('collapse');
        $('#additionalInfoForm').removeClass('collapse');
    })

    $('#additionalInfoCollapse').on('click', () => {
        $('#additionalInfo').removeClass('collapse');
        $('#additionalInfoForm').addClass('collapse');
    })

    $('#martialStatus').on('change', () => {
        if ($('#martialStatus').val() == 'yes') {
            $('#married').removeClass('collapse');
        } else {
            $('#married').addClass('collapse');
        }
    })

    $('#addFamily').on('click', () => {
        $('#formFamily').removeClass('collapse');
    })

    $('#cancel').on('click', () => {
        $('#formFamily').addClass('collapse');
    })

</script>

<script>
    $('.avatar').on('change', '#uploadProfilePic', function (e) {
        var file = e.target.files[0];
        var formData = new FormData();
        formData.append('avatar', file);
        $.ajax({
            url: '/avatar/update',
            method: 'PUT',
            contentType: false,
            processData: false,
            dataType: 'json',
            data: formData,
            success: function() {
                $('.avatar').load(' .avatar');
            }
        });
    });

    $('.avatar').on('click', '.delete-avatar', function (e) {
        $.ajax({
            url: '/avatar/destroy',
            method: 'DELETE',
            success: function() {
                $('.avatar').load(' .avatar');
            }
        })
    });
</script>
